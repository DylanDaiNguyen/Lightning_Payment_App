const fs = require("fs");
const Eclair = require("config");

//Transfer invoices data from pool.json to logged-in user's json
async function getPool(ID){
    const temp = fs.readFileSync("./src/pool.json");
    const pool = JSON.parse(temp);
    const file = "./src/"+ID+".json";
    const text = fs.readFileSync(file);
    var string = JSON.parse(text);
    var i=0;
    var pos = [];
    var j=0;
    while(i<pool.pending.length){
        if(pool.pending[i].to===ID){
            if(pool.pending[i].hasOwnProperty('detail')){
                string.received.push(pool.pending[i].detail);
                string.BTC.ln_Balance = string.BTC.ln_Balance + (pool.pending[i].detail.amount/1);
            }
            /*else{
                Eclair.eclair.getinfo((err3,res3)=>{	//Make sure server is online
                    if(err3){
                        console.log("Server is currently offline");
                    }
                    else {
                        Eclair.eclair.checkinvoice(pool.pending[i].ln_req, (err, res) => {
                            if(err) console.log(err.message);
                            else{
                                if(res){
                                    Eclair.eclair.checkinvoice(pool.pending[i].ln_req, (err1, res1) => {
                                        if(err) console.log(err.message);
                                        else{
                                            
                                        }
                                    })
                                }
                                else {

                                }
                            }
                        })
                    }
                })
            }*/
            pos[j]=i;
            j++;
        }
        i=i+1;
    }
    Array.prototype.remove = function(index){
        this.splice(index,1);
    }
    for(var x=0;x<j;x++){
        pool.pending.remove(pos[x]);
    }
    fs.writeFileSync(file,JSON.stringify(string, null, 2));
    fs.writeFileSync("./src/pool.json",JSON.stringify(pool, null ,2));
}
exports.getPool = getPool;